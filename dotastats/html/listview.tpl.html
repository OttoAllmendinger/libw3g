<!--!  vi: set ft=genshi: -->
<!DOCTYPE html>
<?python

import time

from libdota.constants import TEAM_1, TEAM_2

def player_class(player_name):
    return 'player%s' % player_name

def format_gametime(gamedata):
    return time.strftime("%d.%m.%Y - %H:%M", time.localtime(gamedata['start_time']))

def format_duration(gamedata):
    return "%d min" % (int(gamedata['duration']/60/1000))

replays = util.filter_replays(replaydb.replays.values())

?>

<html xmlns="http://www.w3.org/1999/xhtml"
          xmlns:py="http://genshi.edgewall.org/">
    <head>
        <link rel="icon" type="image/gif" href="/static/images/favicon.gif" />
        <link rel="stylesheet" type="text/css" href="/static/css/style.css" />
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.js"></script>
        <script src="/static/js/jquery.dataset.js"></script>
        <script src="/static/js/jquery.sprintf.js"></script>
        <script src="/static/js/flot/jquery.flot.min.js"></script>
        <script src="/static/js/jquery.getalljson.js"></script>
        <script src="/static/js/consolefix.js"></script>
        <script src="/static/js/local.js"></script>
        <script>
            console.log();
            $(document).ready(function() {
                init();
            });
        </script>

        <title>DotaStats</title>

        <style type="text/css">
            table.overview {
                margin: auto;
                cursor: default;
            }

            table.overview th {
                padding: .2em;
            }

            table.overview td {
                text-align: center;
                width: 100px;
            }

            .player_stats {
                font-weight: bolder;
            }
        </style>
    </head>
    <body>
        <table class="overview lv1">
            <?python
            all_players = sorted(playerdb.players)
            ?>
            <tr>
                <th py:for="player in all_players">
                    ${player}
                </th>
            </tr>
            <tr py:for="n, replay in enumerate(replays)" 
                data-replay="${replay.replay_id}">
                <?python
                players_by_name = dict((p['name'], p) for p in map(
                    playerdb.add_name, replay.gamedata['players'].values()))
                current_players = map(players_by_name.get, all_players)
                ?>
                <py:for each="p in current_players">
                    <td py:if="p" class="player_stats">
                        <img    src="${util.get_hero_image(p.hero)}"
                                class="heroimage
                                       ${'win' if p.is_winner else 'fail'}" />
                    </td>

                    <td class="player_stats absent" py:if="not p">
                    </td>
                </py:for>
            </tr>
        </table>

        <div id="gameinfo" class="tooltip">
        </div>

        <div class="footer">
            dotastats.r${libw3g_version}
        </div>

    </body>
</html>
